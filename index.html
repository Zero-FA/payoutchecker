<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Apex PA Payout Checker</title>
<link rel="icon" href="data:,">
<style>
 /* --- Bigger, more affiliate-focused top banner --- */
.top-bar {
  padding: 18px 0;
}
.top-bar .h1 {
  font-size: 30px;
  letter-spacing: .5px;
}
.top-bar .sub {
  font-size: 14px;
}
.aff-btn {
  font-size: 13px;
  padding: 10px 18px;
  border-width: 2px;
  background:radial-gradient(circle at top left,#1e3a8a,#0f172a);
  box-shadow:0 12px 30px rgba(30,58,138,.5);
}
.aff-btn span {
  font-size: 14px;
}
.top-bar-boost {
  background:rgba(30,64,175,.25);
  border:1px solid rgba(96,165,250,.35);
  padding:12px 16px;
  border-radius:14px;
  margin-bottom:14px;
  text-align:center;
  font-size:20px;
  font-weight:600;
  color:#bfdbfe;
}
.deal-size {
  text-shadow: 0 0 12px rgba(96,165,250,.65);
  font-size: 30px;
  font-weight: 900;
  background: linear-gradient(90deg,#60a5fa,#93c5fd);
  -webkit-background-clip: text;
  color: transparent;
}
  :root{
    --bg:#020617;
    --bg2:#020617;
    --card:#020617;
    --card-soft:#050816;
    --ink:#e5e7eb;
    --muted:#9ca3af;
    --line:#111827;
    --good:#22c55e;
    --bad:#f97373;
    --pill:#10b98133;
    --accent:#60a5fa;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    background:
      radial-gradient(circle at top left, #1d283a 0, #020617 45%),
      radial-gradient(circle at bottom right, #0b1120 0, #020617 55%);
    color:var(--ink);
    font:18px/1.5 system-ui,Segoe UI,Roboto,Helvetica,Arial;
  }
  .wrap{max-width:1120px;margin:32px auto;padding:0 16px}
  .h1{font-weight:800;font-size:24px;margin-bottom:4px;letter-spacing:.02em}
  .sub{color:var(--muted);margin-bottom:4px;font-size:13px}
  .disclaimer{color:#6b7280;font-size:11px;margin-top:2px;margin-bottom:10px}
  .card{
    background:rgba(15,23,42,.96);
    border:1px solid rgba(148,163,184,.12);
    border-radius:18px;
    padding:16px 16px 14px;
    box-shadow:0 18px 40px rgba(0,0,0,.45);
  }
  .card-soft{
    background:rgba(15,23,42,.9);
    border-radius:16px;
    border:1px solid rgba(30,64,175,.5);
    padding:12px 14px;
  }
  .grid{display:grid;gap:12px}
  .cols2{grid-template-columns:1fr 1fr}
  .label{font-size:11px;color:var(--muted);margin-bottom:4px;text-transform:uppercase;letter-spacing:.06em}
  .input,.select{
    width:100%;
    border:1px solid #1f2937;
    background:rgba(15,23,42,.95);
    color:var(--ink);
    border-radius:10px;
    padding:8px 10px;
    font:13px system-ui,Segoe UI,Roboto,Helvetica,Arial;
  }
  .input:focus,.select:focus{
    outline:none;
    border-color:#3b82f6;
    box-shadow:0 0 0 1px rgba(59,130,246,.5);
  }
  .help{font-size:14px;color:var(--muted);margin-top:3px}
  .row{display:flex;gap:8px;align-items:center}
  .row-between{display:flex;justify-content:space-between;align-items:center;gap:8px}
  .ok{color:var(--good)}
  .bad{color:#fb7185}
  .pill{
    display:inline-flex;
    align-items:center;
    gap:6px;
    padding:3px 8px;
    border-radius:999px;
    font-size:11px;
    background:rgba(22,163,74,.12);
    border:1px solid rgba(34,197,94,.5);
  }
  .pill-bad{
    background:rgba(248,113,113,.12);
    border-color:rgba(248,113,113,.7);
    color:#fecaca;
  }
  .pill span.dot{
    width:6px;height:6px;border-radius:999px;
    background:currentColor;
  }
 #yesno span:last-child {
  font-size:18px;   /* change this number */
  font-weight:700;  /* optional but looks clean */
}
  .tile{
    background:#020617;
    border:1px solid #111827;
    border-radius:12px;
    padding:8px 10px;
  }
  .tile-label{font-size:11px;color:var(--muted);margin-bottom:3px}
  .tile-main{font-size:13px;font-weight:600}
  .range{
    background:rgba(6,78,59,.3);
    border:1px solid #047857;
    color:#a7f3d0;
    border-radius:12px;
    padding:9px 10px;
  }
  .list{list-style:none;padding:0;margin:0}
  .list li{
    display:flex;
    gap:8px;
    align-items:flex-start;
    padding:5px 0;
    border-bottom:1px dashed #111827;
  }
  .list li:last-child{border-bottom:0}
  .mono{font:11px ui-monospace,Consolas,Menlo,monospace}
  hr{
    border:none;
    border-top:1px dashed #111827;
    margin:10px 0;
  }
  svg{flex:0 0 auto}
  .tag{
    display:inline-flex;
    align-items:center;
    gap:4px;
    padding:2px 7px;
    border-radius:999px;
    border:1px solid #1d4ed8;
    background:rgba(30,64,175,.18);
    font-size:14px;
    color:#bfdbfe;
  }
  .top-bar{
    display:flex;
    justify-content:space-between;
    align-items:flex-start;
    gap:8px;
    flex-wrap:wrap;
  }
  .aff-btn{
    display:inline-block;
    padding:7px 13px;
    background:radial-gradient(circle at top left,#1d4ed8,#0f172a);
    border:1px solid rgba(96,165,250,.75);
    border-radius:999px;
    color:#dbeafe;
    font-weight:600;
    font-size:12px;
    text-decoration:none;
    box-shadow:0 10px 25px rgba(15,23,42,.8);
  }
  .aff-btn:hover{
    filter:brightness(1.08);
    transform:translateY(-1px);
  }

  /* Trading rules layout */
  .rules-grid{
    display:grid;
    grid-template-columns:repeat(2,minmax(0,1fr));
    gap:4px 10px;
  }
  .rules-grid li{
    border-bottom:none;
    padding:2px 0;
  }
  .rule-main{display:flex;align-items:center;gap:6px}
  .rule-main label{font-size:12px;font-weight:500;cursor:pointer}
  .rule-link{
    font-size:11px;
    color:#60a5fa;
    text-decoration:none;
  }
  .rule-link:hover{text-decoration:underline}

  /* What to Fix badge */
  .fix-badge{
    display:inline-flex;
    align-items:center;
    gap:6px;
    font-size:11px;
    color:#fecaca;
    background:rgba(127,29,29,.55);
    border-radius:999px;
    padding:3px 8px;
    border:1px solid #b91c1c;
    margin-bottom:6px;
  }

  /* Accordion (for Eligibility Checklist) */
  .accordion-header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    cursor:pointer;
    padding:4px 0 2px 0;
  }
  .accordion-title{
    font-weight:600;
    font-size:13px;
  }
  .accordion-icon{
    font-size:12px;
    color:var(--muted);
    margin-left:6px;
  }
  .accordion-body{
    margin-top:6px;
    display:none; /* collapsed by default */
  }

  @media (max-width:920px){
    .cols2{grid-template-columns:1fr}
  }
 /* =======================
   INPUT COMPLETION STATES
   ======================= */

.input.required-empty,
.select.required-empty {
  border-color: #fb7185 !important; /* your red tone */
  box-shadow: 0 0 8px rgba(251, 113, 133, .55);
}

.input.required-filled,
.select.required-filled {
  border-color: #22c55e !important; /* your green tone */
  box-shadow: 0 0 8px rgba(34, 197, 94, .55);
}
 .select.required-unselected {
  border-color: #facc15 !important; /* yellow-400 */
  box-shadow: 0 0 8px rgba(250, 204, 21, .55);
}
 /* =======================
   CHECKBOX COMPLETION STATES
   ======================= */

.checkbox-required-empty {
  filter: drop-shadow(0 0 6px rgba(251, 113, 133, .65)); /* red */
}

.checkbox-required-filled {
  filter: drop-shadow(0 0 6px rgba(34, 197, 94, .65)); /* green */
}

</style>
</head>
<body>
<div class="wrap">

  <!-- Top header / title -->
<div class="top-bar-boost">
  ðŸ’° Get <span class="deal-size">80%</span> off your evaluation using code <strong>ZEROFA</strong> at checkout â€” Click the button on the right!
</div>
  <div class="top-bar">
    <div>
      <div class="h1">Zero's Apex Trader Funding Payout Checker</div>
      <div class="sub">Check your payout eligibility criteria before you submit a request.</div>
      <div class="disclaimer">
        This tool is unofficial and for guidance only; final decisions are made by Apex Trader Funding.
      </div>
    </div>
    <div style="text-align:right;min-width:180px;">
      <a href="https://apextraderfunding.com/member/aff/go/seanodonoghue67"
         target="_blank"
         class="aff-btn">
         Use code <span style="font-weight:800;">ZEROFA</span> at checkout â†’
      </a>
    </div>
  </div>

  <!-- MAIN GRID: 2x2 layout -->
  <div class="grid cols2" style="gap:16px; align-items:start; margin-top:10px;">

    <!-- LEFT COLUMN (top: form + rules, bottom: checklist) -->
    <div class="grid" style="gap:12px">

      <!-- Form + Trading Rules in SAME CARD -->
      <div class="card">
        <!-- Form fields -->
        <div class="grid cols2" style="gap:10px 12px">
          <div>
            <div class="label">PA Status</div>
<select id="paStatus" class="select">
  <option value="">â€” Select PA Status â€”</option>
  <option>Active</option>
  <option>Account Blown</option>
  <option>Failed Rebill</option>
  <option>Invoice Cancelled</option>
</select>
          </div>
          <div>
            <div class="label">Account Size</div>
<select id="account" class="select">
  <option value="">â€” Select Account â€”</option>
  <option value="25k">$25k</option>
  <option value="50k">$50k</option>
  <option value="100k">$100k</option>
  <option value="150k">$150k</option>
  <option value="250k">$250k</option>
  <option value="300k">$300k</option>
  <option value="100kStatic">$100k Static</option>
</select>
          </div>

          <div>
            <div class="label">Approved Payouts So Far</div>
            <input id="approvedCount" class="input" type="number" min="0" placeholder="e.g., 0" />
            <div class="help">
              Enter how many payouts have already been <b>approved</b>.
              The 4th drops the safety net. The 6th removes the 30% rule and caps.
            </div>
          </div>

          <div>
            <div class="label">Last Payout Status</div>
<select id="payoutStatus" class="select">
  <option value="">â€” Select Last Payout Status â€”</option>
  <option value="none">None yet</option>
  <option value="approved">Approved</option>
  <option value="denied">Denied</option>
</select>
            <div id="payoutStatusHelp" class="help">
              All trading days since starting this PA count toward eligibility.
            </div>
          </div>
        </div>

        <hr />

        <div class="grid cols2" style="gap:10px 12px">
          <div>
            <div class="label">Current Balance ($)</div>
            <input id="currentBalance" class="input" inputmode="decimal" placeholder="e.g., 52600" />
          </div>
          <div>
            <div class="label">Desired Payout ($)</div>
            <input id="requestedPayout" class="input" inputmode="decimal" placeholder="e.g., 500" />
            <div class="help">Min $500. Caps apply for first 5 payouts.</div>
          </div>

          <div>
            <div class="label">Highest Profit Day Since Last Approval</div>
            <input id="highestProfitDay" class="input" inputmode="decimal" placeholder="e.g., 600" />
          </div>
          <div>
            <div class="label">Trading Days Since Last Request</div>
            <input id="tradingDays" class="input" type="number" min="0" placeholder="e.g., 8" />
          </div>
          <div>
            <div class="label">Profitable Days â‰¥ $50 Since Last Approval/Denial</div>
            <input id="profitableDays" class="input" type="number" min="0" placeholder="e.g., 5" />
          </div>
        </div>

        <hr style="margin-top:12px;margin-bottom:8px;">

        <!-- Trading Rule Compliance (inside same card) -->
        <div class="row-between" style="margin-bottom:4px;">
          <div style="font-weight:600;font-size:16px;">Trading Rule Compliance (Required)</div>
          <div class="tag">
            <span style="width:7px;height:7px;border-radius:999px;background:#22c55e;"></span>
            Must be TRUE for payout
          </div>
        </div>
        <div style="font-size:14px;color:var(--muted);margin-bottom:6px;">
          Confirm you followed these rules during the payout period. If any were broken, address that with Support before requesting.
        </div>
        <ul id="rulesList" class="list rules-grid"></ul>
      </div>

      <!-- Eligibility Checklist (accordion, bottom-left) -->
      <div class="card">
        <div id="checklistHeader" class="accordion-header">
          <div class="accordion-title">Eligibility Checklist</div>
          <div style="display:flex;align-items:center;gap:6px;">
            <span class="help" style="margin-top:0;font-size:10px;">Click to expand</span>
            <span id="checklistIcon" class="accordion-icon">â–¶</span>
          </div>
        </div>
        <div class="help" style="margin-top:4px;margin-bottom:2px;">
          This updates automatically as you fill out the form and confirm trading rules.
        </div>
        <div id="checklistBody" class="accordion-body">
          <ul id="checklist" class="list" style="margin-top:4px;"></ul>
        </div>
      </div>

    </div>

    <!-- RIGHT COLUMN (top: summary, bottom: what to fix) -->
    <div class="grid" style="gap:12px">
      <!-- Summary -->
      <div id="summaryCard" class="card" style="border-color:#1d4ed8">
        <div class="row-between">
          <div class="row" style="gap:6px">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none"
                 stroke="currentColor" stroke-width="2">
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
              <path d="M22 4 12 14.01l-3-3"></path>
            </svg>
            <div>
              <div style="font-weight:700;font-size:20px">Should this payout be approved?</div>
              <div style="font-size:14px;color:var(--muted);">
                Based on standard PA payout parameters and your inputs.
              </div>
            </div>
          </div>
          <div style="text-align:right;">
            <a href="https://support.apextraderfunding.com/hc/en-us/articles/40507212951451-PA-Payout-Parameters"
               target="_blank"
               style="font-size:11px;color:#93c5fd;text-decoration:none;">
               View Payout Parameters â†’
            </a>
          </div>
        </div>

     <div style="display:flex;align-items:center;gap:12px;margin:6px 0 8px 0;">
          <div id="yesno" class="pill">
            <span class="dot"></span>
            <span>YES</span>
          </div>
          <div style="font-size:14px;color:var(--muted);">
            All conditions (including trading rules) must be met for a strong chance of approval.
          </div>
        </div>

        <!-- Quick stats row -->
        <div class="grid cols2" style="gap:8px 10px;margin-bottom:6px;">
          <div class="tile">
            <div class="tile-label">Safety net required?</div>
            <div class="tile-main" id="safetyReq">â€”</div>
            <div class="help">Safety net = drawdown + $100 â†’ <span id="safetyAmt">â€”</span></div>
          </div>
          <div class="tile">
            <div class="tile-label">Min balance to request</div>
            <div class="tile-main" id="minBal">â€”</div>
            <div class="help">Must remain after payout (â‰¥4th) or be met before request (â‰¤3rd).</div>
          </div>
          <div class="tile">
            <div class="tile-label">Min payout</div>
            <div class="tile-main" id="minPay">$500</div>
            <div class="help">Payout requests below this will not qualify.</div>
          </div>
          <div class="tile">
            <div class="tile-label">Max payout cap</div>
            <div class="tile-main" id="maxCap">â€”</div>
            <div class="help">Caps apply to first 5 payouts by account size.</div>
          </div>
        </div>

        <div id="rangeWrap" class="range" style="margin-top:6px;display:none">
          <div style="font-size:11px;margin-bottom:2px;">Estimated allowed payout range</div>
          <div id="range" style="font-weight:700;font-size:14px">$â€” â€“ $â€”</div>
        </div>
      </div>

      <!-- What to Fix (bottom-right) -->
      <div id="adviceWrap" class="card-soft" style="display:none">
        <div class="fix-badge">
          <span style="width:8px;height:8px;border-radius:999px;background:#fecaca;"></span>
          What you may need to fix before requesting
        </div>
        <ul id="adviceList" class="list"></ul>
      </div>

      <!-- Notes -->
      <div class="card mono" style="font-size:11px;color:var(--muted)">
        Notes: 30% rule is lifted on the 6th payout. Safety net (drawdown + $100) applies to first three payouts only.
        Min payout is $500. First five payouts have account-size caps. After 6th, no cap but you must still satisfy the
        minimum balance and rule-compliance requirements. This tool is an estimator only and does not guarantee approval.
      </div>
    </div>

  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
/* ---------- Data & Helpers ---------- */
const ACCOUNT_CONFIG = {
  "25k": { label:"$25k", startBalance:25000, minReqBalanceFirst3:26600 },
  "50k": { label:"$50k", startBalance:50000, minReqBalanceFirst3:52600 },
  "100k":{ label:"$100k", startBalance:100000, minReqBalanceFirst3:103100 },
  "150k":{ label:"$150k", startBalance:150000, minReqBalanceFirst3:155100 },
  "250k":{ label:"$250k", startBalance:250000, minReqBalanceFirst3:256600 },
  "300k":{ label:"$300k", startBalance:300000, minReqBalanceFirst3:307600 },
  "100kStatic":{ label:"$100k Static", startBalance:100000, minReqBalanceFirst3:102600 },
};
const MAX_PAYOUT_FIRST_FIVE = {
  "25k":1500,"50k":2000,"100k":2500,"150k":2750,"250k":3000,"300k":3500,"100kStatic":1000
};

const TRADING_RULES = [
  { key:"scaling", label:"Contract Scaling Rule", fix:"Confirm you followed the Contract Scaling Rule or address any violations." },
  { key:"mae", label:"30% Negative P&L Rule (MAE)", fix:"Confirm no single trade exceeded the 30% MAE limit." },
  { key:"risk", label:"5:1 Risk-Reward Ratio Rule", fix:"Confirm your stop loss did not exceed 5Ã— your profit target." },
  { key:"hedge", label:"Hedging Rule", fix:"Confirm you did not hedge (long & short on the same/correlated instrument)." },
  { key:"direction", label:"One Direction Rule", fix:"Confirm you did not have conflicting long & short positions or orders." }
];

const RULE_LINKS = {
  scaling: "https://support.apextraderfunding.com/hc/en-us/articles/40463165052955-Contract-Scaling-Rule",
  mae: "https://support.apextraderfunding.com/hc/en-us/articles/40463232267035-30-Negative-P-L-Rule-Maximum-Adverse-Excursion-MAE",
  risk: "https://support.apextraderfunding.com/hc/en-us/articles/40463462503067-5-1-Risk-Reward-Ratio-Rule",
  hedge: "https://support.apextraderfunding.com/hc/en-us/articles/40463541656603-Hedging-and-Correlated-Instruments-Rule",
  direction: "https://support.apextraderfunding.com/hc/en-us/articles/40463473205275-One-Direction-Rule-Directionally-biased-trading"
};

const $ = s => document.querySelector(s);
const fmt = n => (n==null || Number.isNaN(n) ? "â€”" : Number(n).toLocaleString(undefined,{maximumFractionDigits:2}));
const num = s => {
  const v = Number(String(s||"").replace(/[^0-9.-]/g,""));
  return Number.isFinite(v) ? v : 0;
};
const clamp = (x,a,b)=>Math.max(a,Math.min(b,x));

/* ---------- Build Trading Rule Checkbox UI ---------- */
const rulesList = $("#rulesList");
rulesList.innerHTML = "";
TRADING_RULES.forEach(rule => {
  const li = document.createElement("li");
  li.innerHTML = `
    <div class="rule-main">
      <input type="checkbox" id="rule_${rule.key}" data-rule="${rule.key}" />
      <label for="rule_${rule.key}">${rule.label}</label>
    </div>
    <a href="${RULE_LINKS[rule.key]}"
       target="_blank"
       class="rule-link">
       Learn more â†’
    </a>
  `;
  rulesList.appendChild(li);
});

/* ---------- Core evaluation (full logic + trading rules) ---------- */
function evaluate(inputs){
  const cfg = ACCOUNT_CONFIG[inputs.account];
  const payoutNum = clamp(Math.floor(inputs.payoutNumber||0),1,99);
  const minPayout = 500;

  // Standard PA logic
  const safetyNetRequired = payoutNum <= 3;
  const safetyNetAmount = cfg.minReqBalanceFirst3 - cfg.startBalance;
  const minBalanceToRequest = safetyNetRequired ? cfg.minReqBalanceFirst3 : cfg.startBalance + 100;

  const windfallRuleApplies = payoutNum < 6;
  const baseline = cfg.startBalance;
  const totalProfit = Math.max(0, inputs.currentBalance - baseline);
  const windfallPass = !windfallRuleApplies
    ? true
    : (totalProfit === 0
        ? false
        : (inputs.highestProfitDaySinceRef / totalProfit) <= 0.3);

  const eightDaysPass = inputs.tradingDaysSinceRef >= 8;
  const fiveDays50Pass = inputs.profitableDaysOver50SinceRef >= 5;

  const maxPayoutCap = payoutNum <= 5 ? (MAX_PAYOUT_FIRST_FIVE[inputs.account] ?? null) : null;

  const meetsMinBalance = inputs.currentBalance >= minBalanceToRequest;
  const canLeaveMinAfter = inputs.currentBalance - inputs.requestedPayout >= minBalanceToRequest;
  const meetsMinRequest = inputs.requestedPayout >= minPayout;
  const underMaxCap = (maxPayoutCap==null) ? true : inputs.requestedPayout <= maxPayoutCap;

  let safetyNetEncroachmentOK = true;
  if (safetyNetRequired){
    const overage = Math.max(0, inputs.requestedPayout - minPayout);
    const mustHave = cfg.minReqBalanceFirst3 + overage;
    safetyNetEncroachmentOK =
      inputs.requestedPayout === minPayout
        ? inputs.currentBalance >= cfg.minReqBalanceFirst3
        : inputs.currentBalance >= mustHave;
  }

  const paActive = inputs.paStatus === "Active";

  const reasons = [
    {
      pass: paActive,
      label: "Performance Account is active",
      detail: paActive ? "Account is in good standing." : `Status: ${inputs.paStatus}`
    },
    {
      pass: eightDaysPass,
      label: "â‰¥ 8 trading days since last APPROVED payout (or start)",
      detail: `You have ${inputs.tradingDaysSinceRef} day(s).`
    },
    {
      pass: fiveDays50Pass,
      label: "â‰¥ 5 days with â‰¥ $50 profit (in the same period)",
      detail: `You have ${inputs.profitableDaysOver50SinceRef} day(s).`
    },
    {
      pass: windfallPass,
      label: windfallRuleApplies
        ? "30% consistency rule met (no single day > 30% of total profit)"
        : "30% rule not in effect (â‰¥ 6th payout)",
      detail: windfallRuleApplies
        ? `Highest day: $${fmt(inputs.highestProfitDaySinceRef)} | Total profit: $${fmt(totalProfit)} | Ratio: ${totalProfit>0?((inputs.highestProfitDaySinceRef/Math.max(1,totalProfit))*100).toFixed(1):"â€”"}%`
        : undefined
    },
    {
      pass: meetsMinBalance,
      label: safetyNetRequired
        ? `Meets safety net balance (â‰¥ $${fmt(minBalanceToRequest)})`
        : `Meets trailing DD stop balance (â‰¥ $${fmt(minBalanceToRequest)})`,
      detail: `Current balance: $${fmt(inputs.currentBalance)}`
    },
    {
      pass: meetsMinRequest,
      label: `Requested payout â‰¥ $${fmt(minPayout)}`
    },
    {
      pass: underMaxCap,
      label: maxPayoutCap==null
        ? "No max payout cap (â‰¥ 6th payout)"
        : `Under max payout cap for this account & payout # (â‰¤ $${fmt(maxPayoutCap)})`
    },
    {
      pass: safetyNetRequired ? safetyNetEncroachmentOK : canLeaveMinAfter,
      label: safetyNetRequired
        ? (inputs.requestedPayout===minPayout
            ? "Min $500 allowed even if ending encroaches safety net by $500"
            : "Balance exceeds safety net by amount over $500 requested")
        : "Sufficient balance remains after payout (â‰¥ trailing stop)",
      detail: safetyNetRequired
        ? (inputs.requestedPayout===minPayout
            ? `Need â‰¥ $${fmt(minBalanceToRequest)} before request. Ending can be as low as $${fmt(minBalanceToRequest - 500)}.`
            : `For request of $${fmt(inputs.requestedPayout)}, need balance â‰¥ $${fmt(minBalanceToRequest + Math.max(0, inputs.requestedPayout - 500))}.`)
        : `Post-payout balance would be $${fmt(inputs.currentBalance - inputs.requestedPayout)}. Must be â‰¥ $${fmt(minBalanceToRequest)}.`
    },
  ];

  const advice = [];
  if (!eightDaysPass) advice.push("Trade more days until you hit 8 since the last approved payout.");
  if (!fiveDays50Pass) advice.push("You need at least 5 days with â‰¥ $50 profit in the same period.");
  if (windfallRuleApplies && !reasons[3].pass){
    advice.push(`Your highest day ($${fmt(inputs.highestProfitDaySinceRef)}) is >30% of total profit ($${fmt(totalProfit)}). Keep trading until total profit is at least $${fmt(Math.ceil(inputs.highestProfitDaySinceRef/0.3))}.`);
  }
  if (!reasons[4].pass){
    advice.push(
      safetyNetRequired
        ? `Build balance to at least $${fmt(minBalanceToRequest)} to satisfy the safety net.`
        : `Build balance to at least $${fmt(minBalanceToRequest)} (trailing DD stop).`
    );
  }
  if (maxPayoutCap!=null && !reasons[6].pass){
    advice.push(`Requested payout exceeds the max cap of $${fmt(maxPayoutCap)} for this payout number.`);
  }

  // Trading rules (checkboxes) are REQUIRED
  TRADING_RULES.forEach(rule => {
    const box = document.querySelector(`#rule_${rule.key}`);
    const checked = !!(box && box.checked);
    reasons.push({
      pass: checked,
      label: rule.label,
      detail: checked
        ? "You confirmed you followed this trading rule for this payout period."
        : "You must confirm you followed this rule before requesting payout."
    });
    if (!checked){
      advice.push(rule.fix);
    }
  });

  // Final eligibility
  const eligible = reasons.every(r=>r.pass);

  let payoutRangeAllowed = null;
  if (eligible){
    const minAllowed = 500;
    let byBalance = safetyNetRequired
      ? Math.max(500, 500 + Math.max(0, inputs.currentBalance - minBalanceToRequest))
      : inputs.currentBalance - minBalanceToRequest;
    let maxAllowed = Math.floor(byBalance);
    if (maxPayoutCap != null) maxAllowed = Math.min(maxAllowed, maxPayoutCap);
    if (maxAllowed >= minAllowed) payoutRangeAllowed = { min:minAllowed, max:maxAllowed };
  }

  return {
    eligible,
    reasons,
    advice,
    computed:{
      safetyNetRequired,
      safetyNetAmount,
      minBalanceToRequest,
      minPayout,
      maxPayoutCap: maxPayoutCap ?? null,
      mustLeaveAfterPayout: minBalanceToRequest,
      payoutRangeAllowed
    }
  };
}

/* ---------- Wire up UI ---------- */
const fields = {
  paStatus: $("#paStatus"),
  account: $("#account"),
  approvedCount: $("#approvedCount"),
  currentBalance: $("#currentBalance"),
  requestedPayout: $("#requestedPayout"),
  highestProfitDay: $("#highestProfitDay"),
  tradingDays: $("#tradingDays"),
  profitableDays: $("#profitableDays"),
  payoutStatus: $("#payoutStatus"),
  payoutStatusHelp: $("#payoutStatusHelp"),
};

const summary = {
  yesno: $("#yesno"),
  safetyReq: $("#safetyReq"),
  safetyAmt: $("#safetyAmt"),
  minBal: $("#minBal"),
  minPay: $("#minPay"),
  maxCap: $("#maxCap"),
  rangeWrap: $("#rangeWrap"),
  range: $("#range"),
  card: $("#summaryCard"),
  checklist: $("#checklist"),
  adviceWrap: $("#adviceWrap"),
  adviceList: $("#adviceList"),
};

const checklistHeader = document.getElementById("checklistHeader");
const checklistBody = document.getElementById("checklistBody");
const checklistIcon = document.getElementById("checklistIcon");

function getInputs(){
  const approvedCount = Math.max(0, Math.floor(num(fields.approvedCount?.value)));
  const payoutNumber = Math.max(1, (approvedCount || 0) + 1);

  return {
    paStatus: fields.paStatus?.value || "Active",
    account: fields.account?.value || "50k",
    payoutNumber,
    currentBalance: num(fields.currentBalance?.value),
    highestProfitDaySinceRef: num(fields.highestProfitDay?.value),
    tradingDaysSinceRef: Math.max(0, Math.floor(num(fields.tradingDays?.value))),
    profitableDaysOver50SinceRef: Math.max(0, Math.floor(num(fields.profitableDays?.value))),
    requestedPayout: num(fields.requestedPayout?.value),
  };
}
function updateInputGlow() {
const requiredInputs = [
  "approvedCount",
  "currentBalance",
  "requestedPayout",
  "highestProfitDay",
  "tradingDays",
  "profitableDays"
];

  const requiredDropdowns = [
    "paStatus",
    "account",
    "payoutStatus"
  ];

  const requiredCheckboxes = [
    "rule_scaling",
    "rule_mae",
    "rule_risk",
    "rule_hedge",
    "rule_direction"
  ];

// Text inputs (all must be filled; "0" counts as filled)
requiredInputs.forEach(id => {
  const el = document.getElementById(id);
  if (!el) return;

  // A field is VALID (green) as long as it is NOT empty
  // So: "" = red, "0" = green, "123" = green
  let hasValue = el.value.trim() !== "";

  el.classList.toggle("required-empty", !hasValue);
  el.classList.toggle("required-filled", hasValue);
});

// Dropdowns
requiredDropdowns.forEach(id => {
  const el = document.getElementById(id);
  if (!el) return;

  const hasValue = el.value.trim() !== "";
  el.classList.toggle("required-empty", !hasValue);
  el.classList.toggle("required-filled", hasValue);
});

  // Checkboxes
  requiredCheckboxes.forEach(id => {
    const el = document.getElementById(id);
    if (!el) return;

    const wrapper = el.closest("li"); // glow whole row
    const checked = el.checked;

    wrapper.classList.toggle("checkbox-required-empty", !checked);
    wrapper.classList.toggle("checkbox-required-filled", checked);
  });
}

function render(){
  // update helper text for last payout status
  const val = fields.payoutStatus?.value || "none";
  if(val==="none"){
    fields.payoutStatusHelp.textContent = "All trading days since starting this PA count toward eligibility.";
  }else if(val==="denied"){
    fields.payoutStatusHelp.textContent = "If your last payout was denied, the 8-day count and the 5-day â‰¥ $50 requirement start the day after that denial.";
  }else{
    fields.payoutStatusHelp.textContent = "If your last payout was approved, the 8-day count and the 5-day â‰¥ $50 requirement start the day after that approval.";
  }

  const res = evaluate(getInputs());

  // YES/NO + pill style
  summary.yesno.innerHTML = '';
  summary.yesno.className = 'pill' + (res.eligible ? '' : ' pill-bad');
  const dot = document.createElement('span');
  dot.className = 'dot';
  const text = document.createElement('span');
  text.textContent = res.eligible ? 'YES' : 'NO';
  summary.yesno.appendChild(dot);
  summary.yesno.appendChild(text);

  summary.card.style.borderColor = res.eligible ? "#22c55e" : "#fb7185";

  // summary numbers
  summary.safetyReq.textContent = res.computed.safetyNetRequired ? "Yes (first 3 payouts)" : "No";
  summary.safetyAmt.textContent = `$${fmt(res.computed.safetyNetAmount)}`;
  summary.minBal.textContent = `$${fmt(res.computed.minBalanceToRequest)}`;
  summary.minPay.textContent = `$${fmt(res.computed.minPayout)}`;
  summary.maxCap.textContent = res.computed.maxPayoutCap ? `$${fmt(res.computed.maxPayoutCap)}` : "No cap (â‰¥6th)";

  if (res.computed.payoutRangeAllowed){
    summary.rangeWrap.style.display = "block";
    summary.range.textContent = `$${fmt(res.computed.payoutRangeAllowed.min)} â€“ $${fmt(res.computed.payoutRangeAllowed.max)}`;
  } else {
    summary.rangeWrap.style.display = "none";
  }

  // checklist
  summary.checklist.innerHTML = "";
  res.reasons.forEach(r=>{
    const li = document.createElement("li");
    li.innerHTML = `
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
           stroke="${r.pass ? '#22c55e' : '#fb7185'}" stroke-width="2" style="margin-top:2px">
        ${r.pass
          ? '<path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><path d="M22 4 12 14.01l-3-3"></path>'
          : '<circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line>'}
      </svg>
      <div>
        <div style="font-weight:600;font-size:12px">${r.label}</div>
        ${r.detail ? `<div class="help">${r.detail}</div>` : ""}
      </div>`;
    summary.checklist.appendChild(li);
  });

  // advice (What to Fix)
  summary.adviceList.innerHTML = "";
  if (res.advice.length){
    summary.adviceWrap.style.display = "block";
    res.advice.forEach(a=>{
      const li = document.createElement("li");
      li.innerHTML = `<div class="help" style="font-size:14px;">${a}</div>`;
      summary.adviceList.appendChild(li);
    });
  } else {
    summary.adviceWrap.style.display = "none";
  }
}

// input listeners (including rule checkboxes)
document.querySelectorAll("input, select").forEach(el =>
  el.addEventListener("input", () => {
    updateInputGlow();
    render();
  })
);

// Auto-adjust Last Payout Status options based on Approved Payouts count
fields.approvedCount.addEventListener("input", () => {
  const approved = Number(fields.approvedCount.value || 0);
  const payoutSelect = fields.payoutStatus;

  const noneOption = payoutSelect.querySelector('option[value="none"]');

  if (approved > 0) {
    if (noneOption) noneOption.remove();
    if (payoutSelect.value === "none") {
      payoutSelect.value = "approved";
    }
  } else {
    if (!noneOption) {
      const opt = document.createElement("option");
      opt.value = "none";
      opt.textContent = "None yet";
      payoutSelect.prepend(opt);
    }
    payoutSelect.value = "none";
  }

  render();
});

// Accordion toggle for Eligibility Checklist
if (checklistHeader && checklistBody && checklistIcon) {
  checklistHeader.addEventListener("click", () => {
    const isOpen = checklistBody.style.display === "block";
    checklistBody.style.display = isOpen ? "none" : "block";
    checklistIcon.textContent = isOpen ? "â–¶" : "â–¼";
  });
}

updateInputGlow();
render();

}); // DOMContentLoaded
</script>
<script src="https://cdn.vercel-insights.com/v1/script.js" defer></script>
</body>
</html>
